<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>tail -f x.log</title>
    <script type="text/javascript" charset="utf-8">

var output;
var url = "{{.}}";

function init() {
  output = document.getElementById("output");
  var token = getToken("/ws/token");
  var websocket = new WebSocket(url.concat("?token=").concat(token));
  console.log(websocket);
  websocket.onopen = function(e) { print("connected") };
  websocket.onclose = function(e) { print("disconnected") };
  websocket.onmessage = function(e) { print(e.data) };
  websocket.onerror = function(e) { print("ERROR: "+e.data) };
}

function getToken(path) {
  var xmlHttp = new XMLHttpRequest();
  var root = location.protocol + "//" + location.host;
  xmlHttp.open("GET", root.concat(path), false);
  xmlHttp.send(null);
  return xmlHttp.responseText;
}

function print(msg) {
  output.value += msg + "\n"
}

    </script>

  </head>

  <body onload="init()">
    <div id="content">
      <textarea id="output" name="logs" rows="50" cols="80"></textarea>
      <br/>
      <button onclick="output.value=''">Clear logs</button>
    </div>
  </body>


</html>
